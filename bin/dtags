#!/bin/bash

ignore=""
if [ -e '.tagsignore' ]; then
  ignore="--exclude=@.tagsignore"
fi

ctags $ignore \
  --langdef=coffee \
  --langmap=coffee:.coffee \
  --regex-coffee='/^[[:space:]]*([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)[[:space:]]*=[[:space:]]*([a-zA-Z_0-9\.]+)\.extend/\2/c,class/' \
  --regex-coffee='/^[[:space:]]*([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)[[:space:]]*=[[:space:]]*(OpenLayers|OL).Class/\2/c,class/' \
  --regex-coffee='/^[[:space:]]*class[[:space:]]+([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)/\2/c,class/' \
  --regex-coffee='/^[[:space:]]*module.exports[[:space:]]*=[[:space:]]*class[[:space:]]+([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)/\2/c,class/' \
  --regex-coffee='/^[[:space:]]*([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)[[:space:]]*[=:][[:space:]]*(\([^\)]+\))?[[:space:]]*[=-]>/\2/m,method/' \
  --regex-coffee='/^[A-Z]([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)[[:space:]]*=[[:space:]]*$/\2/o,object/' \
  \
  --langdef=js \
  --langmap=js:.js \
  --regex-js='/^[[:space:]]*([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)[[:space:]]*=[[:space:]]*([a-zA-Z_0-9\.]+)\.extend/\2/c,class/' \
  --regex-js='/^[[:space:]]*([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+)[[:space:]]*=[[:space:]]*(OpenLayers|OL).Class/\2/c,class/' \
  --regex-js='/^[[:space:]]*([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+) *[=:] function/\2/m, method/' \
  --regex-js='/^[A-Z]([a-zA-Z_0-9\.]+\.)?([a-zA-Z_0-9]+) *= *{ *$/\2/o, object/' \
  $*

  # I'm defining a new language (js) instead of the built-in (javascript)
  # because I don't want the built in parser's tags
