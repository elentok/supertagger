#!/bin/bash

selector=$1

if [ "$selector" == "" ]; then
  selector=-R\ --include\ '*.js'\ .
fi

function find_extended_classes() {
  grep -H \
    '^[ 	]*[a-zA-Z_\.0-9]\+ = *[a-zA-Z0-9_\.]\+\.extend' $selector | \
    sed -E "s/^([^:]*):[ 	]*((.*\.)*)([^=\. ]*)( *= *)([^\( ]*).*$/\4	\1	\/\3\4\5\6\//"

  # 1 - filename
  # 2 - namespace
  # 3 - namespace
  # 4 - class name
  # 5 - space ( = )
  # 6 - base class
}

function find_js_methods() {
  grep -H \
    '^[ 	]*[a-zA-Z_\.0-9]\+ *[=:] function' $selector | \
    sed -E "s/^([^:]*):[ 	]*(.*\.)?([^=:\. ]+)( *[:=] *)(.*)$/\3	\1	\/\2\3\4\5\//"

  # 1 - filename
  # 2 - namespace
  # 3 - name
  # 4 - space
  # 5 - definition
}

function find_static_js_objects() {
  grep -H -E \
    '^[A-Z][a-zA-Z_\.0-9]* *= *{ *$' $selector | \
    sed -E "s/^([^:]*):[ 	]*(.*\.)?([^=:\. ]+)( *= *{) *$/\3	\1	\/\2\3\4\//"
  
  # 1 - filename
  # 2 - namespace
  # 3 - name
  # 4 - space
  # 5 - definition
}

find_extended_classes
find_static_js_objects
find_js_methods
